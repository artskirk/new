<?php

namespace Datto\Malware;

/**
 * Ransomware configuration
 * @author Chuck Roydhouse <cer@datto.com>
 */
class RansomwareConfiguration
{
    /** Mimetype of an unidentifiable file */
    const UNIDENTIFIABLE_MIMETYPE = 'application/octet-stream';

    /** Chi-squared entropy acceptance threshold */
    const CHI_SQUARED_THRESHOLD = 0.09;

    /** Bit density entropy threshold */
    const DENSITY_THRESHOLD = 7.95;

    /** Default minimum number of samples to pass judgement */
    const DEFAULT_MINIMUM_SAMPLES = 20;

    /** Default maximum number of occurrences to pass judgement */
    const DEFAULT_MAXIMUM_OCCURRENCES = 20;

    /** Default positive occurrence threshold (threshold = (occurrence / total)) */
    const DEFAULT_OCCURRENCE_THRESHOLD = 0.10;

    /** Explicitly excluded extensions */
    const EXCLUDED_EXTENSIONS = [
        '', # No file extension
        'bak', # Backup files
        'bat', # Batch files
        'bin', # Binary files
        'cab', # Windows Cabinet file
        'chk', # Word Perfect temporary files
        'css', # CSS files
        'dat', # Binary files
        'dat64', # Binary files
        'db', # All sorts of databases!
        'dll', # Windows shared objects
        'edb', # Exchange database files
        'exe', # Windows executables
        'gif', # Image files
        'htm', # HTML files
        'html', # HTML files
        'index', # Unix-like directory index files
        'ini', # Settings files
        'jpeg', # Image files
        'jpg', # Image files
        'js', # Javascript files
        'lnk', # Windows shortcuts
        'log', # Log files
        'msi', # Windows installers
        'msm', # Windows installers
        'msp', # Windows installers
        'mst', # Windows installers
        'mui', # Multilingual User Interface files
        'odl', # Active-X code
        'png', # Image files
        'p7m', # Encrypted "smime.p7m" files
        'shs', # Microsoft files
        'sqlite', # SQlite database
        'sys', # Drivers
        'tmp', # Temporary files
        'ttf', # True-type font
        'txt', # Text files
        'vol', # Packed data
        'xml'  # XML files
    ];

    /** Explicitly known extensions */
    const KNOWN_EXTENSIONS = [
        'pdf', # PDF files
        'odt', 'ott', # Open office "word" files
        'ods', 'ots', # Open office "excel" files
        'odp', 'otp', 'odg', # Open office "powerpoint" files
        'doc', 'dot', 'wbk', 'docx', 'docm', 'dotx', 'dotm', 'docb', 'asd', # Microsoft Word files
        'xls', 'xlt', 'xlm', 'xlsx', 'xlsm', 'xltx', 'xltm', 'xlsb', 'xla', 'xlam', 'xll', 'xlw', 'xlk', # Microsoft Excel files
        'ppt', 'pot', 'pps', 'pptx', 'pptm', 'potx', 'potm', 'ppam', 'ppsx', 'ppsm', 'sldx', 'sldm' # Microsoft Powerpoint files
    ];

    /** Explicitly known ransomware extensions */
    const KNOWN_RANSOMWARE_EXTENSIONS = [
        'crab',
        'annabelle',
        'saturn',
        'xtbl',
        'arrow'
    ];

    /**
     * Get excluded extensions as comma-separated single-quoted string.
     * @return string
     */
    public static function getExcludedExtensionString()
    {
        return self::arrayToString(self::EXCLUDED_EXTENSIONS);
    }

    /**
     * Get known extensions as comma-separated single-quoted string.
     * @return string
     */
    public static function getKnownExtensionString()
    {
        return self::arrayToString(self::KNOWN_EXTENSIONS);
    }

    /**
     * Get known ransomware extensions as comma-separated single-quoted string.
     * @return string
     */
    public static function getKnownRansomwareExtensionsString()
    {
        return self::arrayToString(self::KNOWN_RANSOMWARE_EXTENSIONS);
    }
    /**
     * Transform a PHP array into a comma-separated single-quoted string.
     * @param array $array
     * @return string
     */
    private static function arrayToString(array $array)
    {
        return "'" . implode("', '", $array) . "'";
    }
}
